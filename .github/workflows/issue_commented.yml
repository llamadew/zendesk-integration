# Will be run to push an issue comment to zendesk ticket
on:
  issue_comment:
    types: [created]
jobs:
  issue_commented:
    name: Issue comment
    if: ${{ !github.event.issue.pull_request }}
    runs-on: ubuntu-latest
    steps:
      - env:
          ISSUE_NUMBER: ${{ github.event.issue.number }}
        run: |
          echo "Comment on issue #$ISSUE_NUMBER"
      - id: get_ticket
        env:
          ZENDESK_BASIC_AUTH: ${{ secrets.ZENDESK_BASIC_AUTH }}
          ISSUE_URL: ${{ github.event.issue.html_url }}
        run: |
          ## get ticket ID
          tickets=$(curl "https://memsource.zendesk.com/api/v2/search.json?query=external_id:$ISSUE_URL" -H "Authorization: Basic $ZENDESK_BASIC_AUTH" -H "Content-Type: application/json")

          console.log($tickets)

          ticket_number=$(echo $tickets | jq tickets[0].id)

          console.log($ticket_number)
      # - env:
      #     ZENDESK_BASIC_AUTH: ${{secrets.ZENDESK_BASIC_AUTH}}
      #     TICKET_NUMBER: ${{fromJson(steps.set_var.outputs.tickets).results[0].id}}
      #     ISSUE_COMMENT_BODY: ${{ github.event.comment.body }}
      #   run: |
      #     curl -X PUT https://memsource.zendesk.com/api/v2/tickets/$TICKT_NUMBER -H "Authorization: Basic $ZENDESK_BASIC_AUTH" -H "Content-Type: application/json" --data-binary @- <<DATA
      #     {
      #       "ticket": {
      #         "comment":   { "body": "$ISSUE_COMMENT_BODY" },
      #       }
      #     }
      #     DATA

      #     echo "Zendesk ticket commented"

