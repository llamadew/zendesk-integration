# Will be run to create a zendesk ticket out of a issue
on:
  issues:
    types: [opened]
jobs:
  issue_created:
    name: Issue created
    runs-on: ubuntu-latest
    steps:
      - env:
          ZENDESK_BASIC_AUTH: ${{ secrets.ZENDESK_BASIC_AUTH }}
          ISSUE_TITLE: ${{ github.event.issue.title }}
          ISSUE_BODY: ${{ github.event.issue.body }}
          ISSUE_USER: ${{ github.event.issue.user.login }}
          ISSUE_URL: ${{ github.event.issue.html_url }}
        run: |
          curl -X POST https://memsource.zendesk.com/api/v2/tickets -H "Authorization: Basic $ZENDESK_BASIC_AUTH" -H "Content-Type: application/json" --data-binary @- <<DATA
          {
            "ticket": {
              "subject":   "Github Issue: $ISSUE_TITLE",
              "comment":   { "body": "$ISSUE_BODY" },
              "assignee_id": 383200172360,
              "group_id": 360008131599,
              "brand_id": 360002503940,
              "tags": ["phrase"],
              "external_id": "$ISSUE_URL",
              "requester": { "locale_id": 1, "name": "$ISSUE_USER from Github" }
            }
          }
          DATA

          echo "Zendesk ticket created"
      - uses: actions/github-script@v5
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: "**Comment by Tech Support**\n\nOur technical support team got notified and will get in touch with you."
            })

